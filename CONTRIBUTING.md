# 🎵 Moodify 贡献指南

简体中文 | [English](docs/en-US/CONTRIBUTING_EN.md)

> 感谢你对Moodify项目的关注！我们热烈欢迎各种形式的贡献。

Moodify是一个基于AI情绪分析的智能音乐推荐系统。无论你是经验丰富的开发者还是刚开始学习编程，都可以为这个项目做出有价值的贡献。

## 寻找贡献点

### 新手任务 (`good first issue`)
- 为DynamicEmoji组件添加新的表情状态，如困惑、兴奋、沮丧、平静等情绪的Canvas绘制效果，需要学习基本的Canvas API使用方法
- 优化移动端响应式布局，包括调整各个组件在小屏幕设备上的显示效果，确保按钮大小适中、文字清晰可读、触摸操作友好
- 完善组件的无障碍支持，添加aria-label属性、键盘导航支持、屏幕阅读器兼容性，让视障用户也能正常使用应用
- 为项目添加更多语言包翻译，如英语、日语、韩语、法语、德语等，需要翻译界面文本和情绪词汇，了解Vue i18n使用方法
- 修复UI细节问题，包括按钮悬停效果、颜色搭配、字体大小、间距调整、图标对齐等视觉优化工作
- 为各个组件编写详细的使用文档和代码示例，帮助其他开发者理解组件的props、events、slots等API
- 优化加载动画效果，为ProgressLoader组件实现更多样的波形动画模式，让用户等待时有更好的视觉体验
- 为MusicCard组件添加更多交互状态，如加载状态、错误状态、收藏状态的视觉反馈

### 进阶任务 (`help wanted`)
- 深度优化GSAP动画库的使用，减少动画对CPU和内存的占用，实现60fps流畅动画，处理动画冲突和性能瓶颈
- 实现Canvas动画的高级优化技术，基于现有canvasRenderer.js进行离屏渲染、对象池管理、requestAnimationFrame优化
- 扩展useAnimationController和useAudioPlayer组合式函数，添加更复杂的动画控制和音频处理逻辑
- 优化Pinia状态管理，扩展animations.js store功能，处理复杂的应用状态同步和错误恢复
- 实现基于用户行为的偏好学习机制，根据用户历史的情绪输入、点击跳转Spotify等行为，动态调整推荐算法权重
- 开发MusicCard组件的高级交互功能，比如点赞收藏、显示多种情绪配比、支持多种音乐平台的播放链接
- 集成网易云音乐等第三方音乐平台API，需要处理OAuth2.0认证、token刷新、跨域请求等复杂逻辑
- 实现PWA功能，添加Service Worker支持、离线缓存、消息推送等现代Web应用特性

### Bug修复
- 修复Sass弃用警告，将所有组件中的 `@import` 语法替换为新的 `@use` 语法，解决Dart Sass 3.0.0兼容性问题
- 解决mixed-decls警告，修复ResultsView.vue中媒体查询后的声明位置问题，避免未来CSS行为变化
- 修复legacy-js-api警告，升级Sass配置以使用现代API，避免兼容性问题
- 解决Vue Router路由切换时的组件内存泄漏问题，清理未销毁的定时器、事件监听器和Canvas动画循环
- 修复MusicCard组件展开动画的性能问题，优化transform和position计算逻辑
- 解决SCSS样式在不同浏览器下的兼容性问题，特别是CSS Grid、Flexbox、CSS变量的浏览器前缀处理
- 修复EmotionInput组件在快速输入时的状态同步问题，防止竞态条件和动画冲突
- 解决DynamicEmoji Canvas组件的内存泄漏问题，优化canvasRenderer.js的资源管理

### 功能增强
- 开发用户音乐心情历史记录功能，包括数据持久化存储、时间线视图、统计分析、数据导出等完整功能模块
- 实现社交分享功能，让用户可以分享自己的音乐心情到微博、微信、Twitter等平台，生成精美的分享卡片
- 建立个性化主题定制系统，允许用户自定义颜色方案、字体大小、动画速度等界面参数，保存用户偏好设置
- 开发高级音频控制功能，包括音量淡入淡出、播放速度调节、音效处理、均衡器控制等专业音频功能
- 实现实时协作听歌功能，多个用户可以同步听同一首歌，支持聊天互动、情绪同步、播放列表共享
- 构建智能播放列表生成系统，根据用户当前情绪、时间、天气等因素自动生成个性化播放列表
- 开发音乐情绪数据分析面板，为用户提供详细的听歌习惯分析、情绪变化趋势、音乐偏好演变等数据洞察
- 实现跨设备同步功能，让用户在不同设备间同步播放进度、收藏列表、个人设置等数据

## 贡献流程

### 1. Fork 和分支策略

```bash
# Fork 仓库后，添加上游仓库
git remote add upstream https://github.com/original-owner/moodify.git

# 创建功能分支
git checkout -b feat/add-emotion-history
```

**分支命名规范：**

分支命名应该简洁明了，包含功能或修复的简要描述。以下是一些示例：

```bash
✅ 好的示例：
feat/add-emotion-history           # 添加情绪历史功能
fix/canvas-memory-leak            # 修复Canvas内存泄漏
docs/update-api-documentation     # 更新API文档
style/improve-mobile-layout       # 改进移动端布局

❌ 避免这样：
my-feature                        # 太模糊
fix-bug                          # 不具体
update                           # 没有说明更新什么
```

### 2. 提交信息规范

我们使用项目特定的提交风格，以动词开头，后跟详细描述：

```
动词. 简短描述，具体说明做了什么改动

[可选的详细描述，解释具体的修改内容和原因]

[可选的Issue链接]
```

**✅ 好的提交信息示例：**
```bash
Add. 添加贡献指南，提供开发环境设置和贡献流程说明
Refactor. 优化动态表情组件的画布尺寸和样式，调整响应式设计
Remove. 删除环境配置文件，更新.gitignore以排除环境变量文件
Fix. 修复测试模式下的AI分析生成逻辑，确保使用正确的情绪结果并修复展示内容
Update. 添加AI情绪分析结果展示，优化用户输入和AI结果的交互逻辑，重构相关组件样式
```

**常用动词前缀：**
```bash
Add.         # 添加新功能、新文件、新组件
Update.      # 更新现有功能、优化现有代码
Fix.         # 修复Bug、解决问题
Remove.      # 删除文件、移除功能
Refactor.    # 重构代码、优化结构
```

**❌ 避免这样的提交：**
```bash
修复bug                          # 没有说明具体修复了什么
更新文件                         # 太模糊，没有具体信息
wip                             # 不应该提交未完成的工作
临时提交                         # 无意义的提交信息
```

### 3. Pull Request 指南

#### PR 标题
使用与提交信息相同的格式：
```
Add. 添加实时情绪分析功能
```

#### 提交前检查清单

在提交PR之前，请确保以下项目都已完成：

- [ ] **🎨 代码规范**：代码通过 ESLint 检查 (`npm run lint`)
- [ ] **💅 代码格式化**：代码已格式化 (`npm run format`)
- [ ] **🧪 功能测试**：确保新功能正常工作，没有破坏现有功能
- [ ] **📱 兼容性测试**：在不同浏览器和设备上测试（Chrome、Firefox、Safari、移动端）
- [ ] **🖥️ 控制台检查**：没有明显的控制台错误或警告
- [ ] **📝 文档更新**：如果添加了新功能或修改了API，相关文档已更新
- [ ] **🔧 测试用例**：为新功能添加单元测试，为Bug修复添加回归测试
- [ ] **📊 性能影响**：确保修改不会显著影响应用性能，特别是动画和Canvas相关修改
- [ ] **🔗 Issue关联**：在PR描述中关联相关的Issue编号

#### PR 描述示例

**✅ 好的PR描述：**
```markdown
Add. 添加用户情绪历史记录功能

## 功能说明
为用户提供查看历史情绪记录的功能，包括：
- 情绪数据本地存储（使用localStorage）
- 时间线形式展示历史记录
- 按日期和情绪类型筛选
- 历史记录数据导出功能

## 技术实现
- 新增 `EmotionHistory.vue` 组件
- 创建 `useEmotionHistory` composable
- 添加历史记录页面路由
- 实现数据持久化和管理

## 测试情况
- ✅ 单元测试已添加并通过
- ✅ Chrome/Firefox/Safari 兼容性测试通过
- ✅ 移动端响应式测试通过
- ✅ 数据存储和读取功能测试通过

## 相关Issue
Closes #156

## 截图
[添加功能截图或GIF演示]
```

**❌ 避免这样的PR：**
```markdown
修复bug

修复了一些问题

Closes #123
```

以上示例不一定要求每个PR都包含所有细节，但至少应包含对应的提交、功能描述、测试情况和相关Issue链接，以便更好地理解和审查代码。

#### PR 最佳实践
- **保持PR小而专注**：一个PR只解决一个明确的问题或添加一个功能
- **提供清晰的上下文**：详细说明为什么需要这个更改，解决了什么问题
- **及时响应审查反馈**：积极参与代码审查讨论，快速响应修改建议
- **保持分支更新**：定期rebase主分支，避免合并冲突

## 沟通与反馈

在开发过程中，良好的沟通是成功协作的关键。我们提供以下几种沟通渠道，欢迎各种类型的反馈和建议。

### 沟通渠道

你可以通过以下方式与我们沟通和交流：

- **🐛 Issues**: Bug报告、功能请求、技术讨论
- **💬 Discussions**: 一般性讨论、经验分享、问题咨询
- **📋 Pull Request Reviews**: 代码审查和实现讨论
- **📧 Email**: 敏感问题或私人咨询

### Issue 提交规范

Issues是参与项目的重要方式，优质的Issue能帮助我们快速理解和解决问题。以下是提交Issue的几种示例，包含好的和坏的，希望能帮助你更好地描述问题或需求。

#### Bug报告

**✅ 优秀的Bug报告示例:**
```markdown
标题: [Bug] 情绪输入时主页表情动画卡顿导致浏览器崩溃

**问题描述**
在快速连续输入多个情绪词汇时，DynamicEmoji组件的表情动作动画出现严重卡顿，
然后Firefox浏览器标签页崩溃。

**环境信息**
- 操作系统: Windows 11 (22H2)
- 浏览器: Firefox 119.0.1
- Node.js: v18.17.0
- 项目版本: v1.2.3

**复现步骤**
1. 打开应用首页
2. 在情绪输入框中快速输入"XXX"
3. 立即删除并输入"XXXX"
4. 重复步骤2-3约10次
5. 观察主页大表情区域出现卡顿
6. 继续操作约30秒后浏览器标签页崩溃

**预期行为**
正常情况下动画应该流畅切换，不应该导致性能问题或浏览器崩溃

**实际行为**
- Canvas动画帧率明显下降
- 浏览器占用内存持续增加
- 最终导致标签页崩溃

**附加信息（可选）**
- 在Chrome和Safari中也有类似问题，但不会崩溃
- 开发者工具显示内存占用从50MB增长到500MB+
- Console显示多个"requestAnimationFrame callback"错误
```

**❌ 不好的Bug报告示例:**
```markdown
标题: 动画有问题

页面动画卡了，修复一下。    <- 缺少关键信息，既没有描述具体问题，也没有提供复现步骤或环境信息。
```

#### 功能请求

**✅ 优秀的功能请求示例:**
```markdown
标题: [Feature] 添加音乐播放历史记录和个性化推荐学习

**功能描述**
希望添加用户音乐播放历史记录功能，并基于历史数据改进个性化推荐算法。

**问题/需求背景**
目前的推荐系统仅基于当前情绪状态，没有考虑用户的长期音乐偏好。
我希望系统能"记住"他们的音乐品味，提供更精准的推荐。

**详细需求**
1. 播放历史记录
   - 记录播放的歌曲、时长、跳过时间点
   - 记录播放时的情绪状态标签
   - 提供历史记录查看界面

2. 偏好学习算法
   - 分析用户在不同情绪下的音乐偏好模式
   - 学习用户喜欢/跳过的音乐特征
   - 根据播放完整度判断用户喜好程度

**使用场景（可选）**
- 比如用户在"放松"状态下经常听古典音乐，系统就应优先推荐古典乐
- 能不能添加一个音乐品味变化趋势？我想看到自己在不同时间段的音乐偏好变化

**技术实现建议（可选）**
- 使用IndexedDB存储播放历史
- 实现机器学习算法分析用户偏好
- 考虑隐私保护，提供数据清除选项
```

**❌ 不好的功能请求示例:**
```markdown
标题: 加个历史功能

可以看历史记录吗？    <- 这样的描述模糊不清，没有具体需求，提供的功能信息太少。
                       你要的是情绪历史记录，还是音乐播放历史记录？详细的需求和使用场景
                       都没有说明，无法理解具体期望。
```

同样，在提交Issue时并不需要包含示例中的所有细节，但至少应该有对应的问题描述、环境信息和复现步骤，对于功能需求则应该有清晰的功能描述和详细需求内容，以便我们更好地理解和处理。

## 代码质量建议

为了维护项目的稳定性，我们希望所有贡献都能遵循一定的代码质量标准，也希望各位贡献者能提供一些手动测试帮助我们验证代码的正确性。

### 现有的工具支持

目前项目配置了以下工具来帮助维护代码质量：

#### ESLint 代码检查
```bash
npm run lint    # 检查代码规范并自动修复
```

如果你愿意，可以在提交前运行一下，帮助发现潜在的代码问题。

#### Prettier 代码格式化
```bash
npm run format  # 格式化 src/ 目录下的代码
```

这个工具可以帮助保持代码风格的一致性，如果方便的话可以使用一下。

### 测试建议

由于项目目前还没有配置自动化测试（这是我们的不足），如果你能帮忙进行一些手动测试，我们会非常感激：

#### 基础功能验证
- 新功能是否按预期工作
- 是否影响了现有功能
- 在你常用的浏览器中是否正常显示

#### 如果可以的话，也希望能测试一下
- 移动端的显示效果（如果你有设备的话）
- 不同情绪输入的Canvas动画效果
- 控制台是否有明显的错误信息

### 我们的计划

我们正在考虑添加以下测试工具，如果你有经验或兴趣，非常欢迎你的建议或帮助：

- 单元测试框架（可能是Vitest）
- E2E测试工具（也可能是Cypress）
- 自动化的性能监控

### 完全没问题的情况

如果你不方便进行测试，或者对某些工具不熟悉，这完全没问题！我们会尽力帮助验证你的贡献。最重要的是你愿意参与到项目中来。

## 行为准则

### 包容性社区

我们致力于创建一个包容、友好、多元化的开源社区。欢迎所有背景的贡献者参与。

#### 我们鼓励的行为:
- **尊重不同观点**: 认真倾听和考虑不同的技术方案和意见
- **建设性反馈**: 提供具体、可操作的改进建议
- **耐心指导**: 帮助新手理解项目结构和开发流程
- **协作精神**: 优先考虑项目整体利益，而非个人偏好
- **持续学习**: 保持开放心态，从他人的贡献中学习

#### 不被接受的行为:
- 人身攻击、侮辱或歧视性言论
- 骚扰、恐吓或威胁行为
- 发布他人私人信息
- 故意破坏项目或恶意提交
- 不当的商业推广或垃圾信息

如果您认为贡献指南的内容有不合理、过于复杂或不符合实际的地方，欢迎在 GitHub 上提出 Issue 或联系开发者提出改进建议。我是一个初来乍到的开发者，并不熟悉所有的开发流程和规范，可能会存在一些问题复杂化、内容冗长的情况。我会尽力改进和优化这些内容，以便更好地服务于社区。

### 冲突解决

当出现意见分歧时，我们鼓励:

1. **开放对话**: 在相关 Issue 或 PR 中公开讨论
2. **技术导向**: 基于技术优劣和项目目标做决策
3. **寻求第三方意见**: 邀请其他贡献者或维护者参与讨论
4. **妥协与折中**: 寻找双方都能接受的解决方案

---

感谢你的贡献！让我们一起打造更好的音乐推荐体验。如有任何疑问，欢迎通过 GitHub Issues 或 Discussions 与我们交流。

> 💡 **提示**: 查看我们的 [开发文档](docs/development.md) 和 [部署指南](docs/deployment.md) 了解更多技术细节。
